# disp - Visualization & Display

Octave/MATLAB scripts for creating publication-quality visualizations of the analysis results.

## Purpose

Generate figures and plots for:
- **Lyapunov Exponent Analysis**: Visualize chaos indicators and sensitivity measures
- **Statistical Reports**: Period distributions, factorization patterns
- **Final Report**: Publication-ready figures

## Structure

```
disp/
├── plot_all.m                      # Master script - generates all figures
├── plot_lyapunov_vs_length.m       # Lambda vs sequence length scatter plot
├── plot_period_vs_lambda.m         # Period vs lambda (log scale)
├── plot_classification_pie.m       # Behavioral classification pie chart
├── plot_top_sequences.m            # Top N most chaotic sequences bar chart
├── scripts/
│   ├── video_to_gif.sh            # Convert screen recordings to GIF
│   └── sequences_to_record.txt    # Checklist of sequences to visualize
├── figures/                        # Output directory for all figures
│   ├── *.png                      # Octave-generated plots
│   └── sequence_*.gif             # Hyperspeedcube visualizations
├── VISUALIZATION_GUIDE.md          # Guide for creating sequence GIFs
└── README.md                       # This file
```

## Prerequisites

- **Octave 6.0+** or **MATLAB R2019+**
- Lyapunov analysis data from `obsv/` (run analysis first)

### Installing Octave

**Ubuntu/Debian**:
```bash
sudo apt install octave
```

**macOS**:
```bash
brew install octave
```

**Arch Linux**:
```bash
sudo pacman -S octave
```

## Usage

### Generate All Figures

The easiest way is to use the master script:

```octave
cd disp
octave plot_all.m
```

Or from within Octave:

```octave
cd disp
plot_all()
```

This generates all figures in `disp/figures/`:
- `lyapunov_vs_length.png`
- `period_vs_lambda.png`
- `classification_pie.png`
- `top_chaotic_sequences.png`

### Custom Data File

If your Lyapunov data is in a different location:

```octave
plot_all('../path/to/lyapunov_data.csv')
```

### Custom Output Directory

Specify both data file and output directory:

```octave
plot_all('../obsv/logs/lyapunov_data.csv', 'my_figures')
```

### Individual Plots

Generate specific plots individually:

```octave
% Lambda vs length
plot_lyapunov_vs_length('../obsv/logs/lyapunov_data.csv', 'figures/lambda_length.png')

% Period vs lambda
plot_period_vs_lambda('../obsv/logs/lyapunov_data.csv', 'figures/period_lambda.png')

% Classification pie chart
plot_classification_pie('../obsv/logs/lyapunov_data.csv', 'figures/pie.png')

% Top 10 sequences
plot_top_sequences('../obsv/logs/lyapunov_data.csv', 'figures/top10.png', 10)
```

## Data Requirements

The scripts expect CSV data with the following columns (generated by `obsv/lyapunov.py`):

| Column | Type | Description |
|--------|------|-------------|
| sequence | string | Move sequence (e.g., "FR → UF") |
| sequence_length | int | Number of moves |
| base_period | int | Period of base sequence |
| lyapunov_exponent | float | Discrete Lyapunov exponent λ |
| classification | string | "regular", "sensitive", or "chaotic" |
| perturbations_tested | int | Number of perturbations |
| mean_ratio | float | Mean period ratio |
| std_ratio | float | Std dev of ratios |
| max_ratio | float | Maximum ratio observed |
| mean_divergence | float | Mean absolute divergence |
| max_divergence | float | Maximum divergence |

## Workflow

1. **Run Analysis** (in `obsv/`):
   ```bash
   cd ../obsv
   uv run python scripts/run_lyapunov.py --from-logs --max-sequences 10
   ```

2. **Generate Figures** (in `disp/`):
   ```bash
   cd ../disp
   octave plot_all.m
   ```

3. **View Results**:
   ```bash
   ls figures/
   # Open PNG files in your image viewer
   ```

## Figure Descriptions

### 1. Lyapunov Exponent vs Sequence Length

**File**: `lyapunov_vs_length.png`

Scatter plot showing how λ varies with sequence length. Color-coded by classification:
- **Blue**: Regular (λ < 0.1)
- **Orange**: Sensitive (0.1 ≤ λ < ln 2)
- **Red**: Chaotic (λ ≥ ln 2)

Includes threshold lines at λ = 0.1 and λ = ln(2) ≈ 0.69.

### 2. Period vs Lyapunov Exponent

**File**: `period_vs_lambda.png`

Log-scale scatter plot investigating correlation between base period and sensitivity. Shows whether longer periods tend to be more chaotic.

### 3. Classification Pie Chart

**File**: `classification_pie.png`

Pie chart showing percentage distribution of sequences across behavioral classifications. Useful for summary statistics.

### 4. Top Chaotic Sequences

**File**: `top_chaotic_sequences.png`

Horizontal bar chart of the N sequences with highest Lyapunov exponents. Shows which move combinations are most sensitive to perturbations.

## Customization

All plotting functions accept parameters for customization:

```octave
% Change number of top sequences shown
plot_top_sequences(data_file, output_file, 15)  % Show top 15

% Modify colors in scripts
% Edit the 'colors' struct in each .m file:
colors = struct('regular', [R, G, B], ...
               'sensitive', [R, G, B], ...
               'chaotic', [R, G, B]);
```

## Output Quality

All figures are generated at:
- **Resolution**: 300 DPI (publication quality)
- **Format**: PNG (easy to include in LaTeX/Markdown)
- **Size**: 800x600 or 900x700 pixels

For other formats (PDF, EPS, SVG):

```octave
% Modify the print command in each script:
print(output_file, '-dpdf');  % PDF
print(output_file, '-deps');  % EPS
print(output_file, '-dsvg');  % SVG
```

## Troubleshooting

### "Cannot open file" error

Make sure you've run the Lyapunov analysis first:
```bash
cd ../obsv
uv run python scripts/run_lyapunov.py
```

### Graphics issues in Octave

If plots don't display or save correctly:

```octave
% Set graphics toolkit
graphics_toolkit('gnuplot')  % or 'qt' or 'fltk'

% Check available toolkits
available_graphics_toolkits()
```

### Permission errors

Make sure `figures/` directory is writable:
```bash
mkdir -p figures
chmod 755 figures
```

## Integration with Report

Include figures in LaTeX:

```latex
\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth]{../disp/figures/lyapunov_vs_length.png}
    \caption{Discrete Lyapunov exponent vs sequence length for 4D hypercube trajectories}
    \label{fig:lyapunov-length}
\end{figure}
```

Or in Markdown:

```markdown
![Lyapunov vs Length](disp/figures/lyapunov_vs_length.png)
```

## Mathematical Background

These visualizations illustrate the discrete Lyapunov exponent:

$$\lambda(S) = \frac{1}{n} \sum_{i=1}^{n} \log\left|\frac{\text{Period}(S_i^\text{perturbed})}{\text{Period}(S)}\right|$$

- **λ > ln(2)**: Chaotic-like behavior (high sensitivity)
- **λ ≈ 0**: Regular behavior (stable under perturbations)

See `docs/mathematical_framework.md` Section 10.1 for detailed theory.

---

## Hyperspeedcube Visualizations

In addition to statistical plots, we create animated GIFs of actual 4D hypercube sequences using Hyperspeedcube.

### Quick Start

1. **Read the comprehensive guide**:
   ```bash
   cat RECORDING_GUIDE.md
   ```

2. **Check the recording checklist**:
   ```bash
   cat sequences_to_record.txt
   ```

3. **Start recording session**:
   ```bash
   ./start_recording.sh  # Enters Nix environment with all tools
   ```

4. **Launch Hyperspeedcube** (in Nix shell):
   ```bash
   cd ../hyper/Hyperspeedcube
   ./target/release/hyperspeedcube &
   ```

5. **Record sequences** (see RECORDING_GUIDE.md for details):
   - Set up 3^4 puzzle (Ctrl+R to reset)
   - Start screen recording (SimpleScreenRecorder/OBS)
   - Perform move sequence
   - Stop recording

6. **Convert to GIF**:
   ```bash
   cd disp  # (in Nix shell)
   ./scripts/video_to_gif.sh recordings/video.mp4 figures/sequence_NAME.gif
   ```

### Priority Sequences

Based on self-composition Lyapunov analysis:

**Tier 1 - Must Have:**
| Sequence | Period | λ | Notes |
|----------|--------|---|-------|
| FO → FO | 4 | 6.093 | **Highest chaos** - self-composition |
| FR (single) | 8 | 0.0 | **Baseline** - trivial behavior |
| FR → FR | 4 | 5.942 | **Self-composition** amplifies chaos |

**Tier 2 - Highly Recommended:**
| Sequence | Period | λ | Notes |
|----------|--------|---|-------|
| RO → RO | 4 | 5.850 | O-face pattern confirmation |
| FR → UF | 10,080 | 3.949 | Huge period, moderate chaos |
| FR → OR → UF | 7,920 | 4.358 | Best non-self-composition |

**Key Insight:** Self-composition of O-face moves (FO, RO, OL) produces extreme chaos despite short periods!

### GIF Specifications

- **Resolution**: 480px width (scaled from 1080p recording)
- **Framerate**: 15 fps
- **Size**: < 5MB per GIF
- **Duration**: 2-3 full periods (or ~10 moves for long sequences)
- **Format**: Optimized GIF with 256 colors

### Video to GIF Conversion

Our helper script handles all optimization automatically:

```bash
# Standard conversion
./scripts/video_to_gif.sh input.mp4 output.gif

# High quality (larger file)
./scripts/video_to_gif.sh input.mp4 output.gif 640 20

# Small file (for email/web)
./scripts/video_to_gif.sh input.mp4 output.gif 320 10
```

### Recording Tips

- **Slow down animation**: Settings > Animation Speed → 0.25x or 0.5x
- **Use high contrast**: Settings > Stickers > High Contrast
- **Good 4D projection**: Use "Schlegel" or "Stereographic" view
- **Start from solved**: Always reset puzzle (Ctrl+R) before recording
- **Solid background**: White or black background recommended

### Integration with Report

Include GIFs in LaTeX using `animate` package:

```latex
\usepackage{animate}

\begin{figure}[h]
    \centering
    \animategraphics[width=0.6\textwidth,autoplay,loop]{15}{figures/sequence_FR_UF}{}{}
    \caption{FR → UF sequence showing period of 10,080}
\end{figure}
```

Or as static images in Markdown/LaTeX:

```markdown
![FR → UF sequence](figures/sequence_FR_UF.gif)
```

```latex
\begin{figure}[h]
    \centering
    \includegraphics[width=0.6\textwidth]{figures/sequence_FR_UF.gif}
    \caption{FR → UF sequence}
\end{figure}
```

### Tools Required

- **Hyperspeedcube**: `../hyper/Hyperspeedcube` (Rust build)
- **Screen recorder**: SimpleScreenRecorder (Linux), OBS (cross-platform), or built-in tools
- **FFmpeg**: For video → GIF conversion
- **Gifsicle**: For GIF optimization

Install on Arch Linux:
```bash
sudo pacman -S simplescreenrecorder ffmpeg gifsicle
```

See `VISUALIZATION_GUIDE.md` for detailed instructions and troubleshooting.
